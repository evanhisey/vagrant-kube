# -*- mode: ruby -*-
# vi: set ft=ruby :
guestOS= "fedora/38-cloud-base"

Vagrant.configure("2") do |config|
  config.vagrant.plugins = "vagrant-libvirt"
  config.vm.provider "libvirt" do |vb|
     vb.memory = "2048"
     vb.cpus = "1"
  end
  
  %w{worker1 worker2}.each_with_index do |name, i|
    config.vm.define name do |worker|
     worker.vm.box = guestOS
     worker.vm.hostname = name
  
    end
  end  
 
  config.vm.define :master do |master|
    master.vm.box = guestOS
    master.vm.hostname = "master"
    master.vm.provision "ansible" do |ansible|
      ansible.verbose = "v"
      ansible.limit = "all"
      ansible.groups = {
         "cluster" => [
         "master",
         "worker1",
         "worker2",
         ]
       }  
      ansible.playbook = "bootstrap.yml"
      end
  end
end